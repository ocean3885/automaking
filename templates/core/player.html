<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
        }
        .player-container {
            width: 90%;
            max-width: 600px;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        #audio-player {
            width: 100%;
        }
        
        /* ğŸ’¡ [CSS ì¶”ê°€] ë²„íŠ¼ì„ ë‹´ì„ ì»¨í…Œì´ë„ˆ */
        .controls-container {
            margin: 1rem 0;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        /* ğŸ’¡ [CSS ì¶”ê°€] ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .controls-container button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
        }
        .controls-container button:hover {
            background-color: #0056b3;
        }

        #sentence-display {
            min-height: 100px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
            margin-top: 1rem; /* ë²„íŠ¼ê³¼ì˜ ê°„ê²© í™•ë³´ */
        }
        #original-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        #translated-text {
            font-size: 1rem;
            color: #666;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <h1>ìŒì„± í•™ìŠµ</h1>
        <audio id="audio-player" controls>
            <source src="{{ audio_data_uri }}" type="audio/mpeg">
            ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ ìš”ì†Œë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </audio>

        <div class="controls-container">
            <button id="skip-backward-btn">&laquo; 5ì´ˆ ë’¤ë¡œ</button>
            <button id="skip-forward-btn">5ì´ˆ ì•ìœ¼ë¡œ &raquo;</button>
        </div>

        <div id="sentence-display">
            <p id="original-text">ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ì„¸ìš”.</p>
            <p id="translated-text"></p>
        </div>
    </div>

    <script>
        // Django ë·°ì—ì„œ ì „ë‹¬ëœ JSON ë°ì´í„°ë¥¼ JavaScript ê°ì²´ë¡œ íŒŒì‹±
        const syncData = JSON.parse('{{ sync_data_json|escapejs }}');
        
        // HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const audioPlayer = document.getElementById('audio-player');
        const originalTextElem = document.getElementById('original-text');
        const translatedTextElem = document.getElementById('translated-text');
        
        // ğŸ’¡ [JS ì¶”ê°€] 5ì´ˆ ì´ë™ ë²„íŠ¼ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const skipBackwardBtn = document.getElementById('skip-backward-btn');
        const skipForwardBtn = document.getElementById('skip-forward-btn');

        let currentSentenceIndex = -1; // í˜„ì¬ í™œì„±í™”ëœ ë¬¸ì¥ì˜ ì¸ë±ìŠ¤ ì¶”ì 

        // ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œê°„ì´ ì—…ë°ì´íŠ¸ë  ë•Œë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        audioPlayer.addEventListener('timeupdate', () => {
            const currentTime = audioPlayer.currentTime;
            
            // í˜„ì¬ ì¬ìƒ ì‹œê°„ì— ë§ëŠ” ë¬¸ì¥ì„ ì°¾ê¸°
            const activeSentenceIndex = syncData.findIndex(item => 
                currentTime >= item.start && currentTime < item.end
            );

            // í˜„ì¬ ë¬¸ì¥ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ í™”ë©´ ì—…ë°ì´íŠ¸ (íš¨ìœ¨ì„±)
            if (activeSentenceIndex !== -1 && activeSentenceIndex !== currentSentenceIndex) {
                const sentence = syncData[activeSentenceIndex];
                originalTextElem.textContent = sentence.text;
                translatedTextElem.textContent = `(${sentence.translation})`;
                currentSentenceIndex = activeSentenceIndex;
            }
        });

        // ì˜¤ë””ì˜¤ ì¬ìƒì´ ëë‚˜ë©´ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        audioPlayer.addEventListener('ended', () => {
            originalTextElem.textContent = 'ì¬ìƒ ì™„ë£Œ!';
            translatedTextElem.textContent = 'ë‹¤ì‹œ ì¬ìƒí•˜ë ¤ë©´ ì²˜ìŒìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.';
            currentSentenceIndex = -1;
        });
        
        // ğŸ’¡ [JS ì¶”ê°€] 5ì´ˆ ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        skipBackwardBtn.addEventListener('click', () => {
            // í˜„ì¬ ì‹œê°„ì—ì„œ 5ì´ˆë¥¼ ë¹¼ê³ , 0ì´ˆ ë¯¸ë§Œìœ¼ë¡œ ë‚´ë ¤ê°€ì§€ ì•Šë„ë¡ ì„¤ì •
            audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 5);
        });

        // ğŸ’¡ [JS ì¶”ê°€] 5ì´ˆ ì•ìœ¼ë¡œ ê°€ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        skipForwardBtn.addEventListener('click', () => {
            // ì˜¤ë””ì˜¤ì˜ ì „ì²´ ê¸¸ì´(duration)ë¥¼ ì•Œê³  ìˆì„ ë•Œë§Œ ìµœëŒ€ê°’ ì œí•œ
            if (audioPlayer.duration) {
                // í˜„ì¬ ì‹œê°„ì—ì„œ 5ì´ˆë¥¼ ë”í•˜ê³ , ì „ì²´ ê¸¸ì´ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì„¤ì •
                audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 5);
            } else {
                // duration ë¡œë“œ ì „ì´ë©´ ì¼ë‹¨ 5ì´ˆ ë”í•˜ê¸°
                audioPlayer.currentTime += 5;
            }
        });
    </script>
</body>
</html>